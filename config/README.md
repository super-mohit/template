# Configuration Directory

This directory contains all deployment configuration files. Update these files to customize your deployment settings instead of modifying the pipeline YAML directly.

## Files

### `deployment.yaml` ‚≠ê Main Configuration
**Complete deployment configuration for Azure DevOps Pipeline.**

This is the **single source of truth** for:
- Docker/ACR repository names and service connections
- Kubernetes/AKS cluster details and namespaces
- Service ports and replica counts
- Ingress domain and path configurations
- Image pull policies and secrets
- Rolling update strategies

**Format:** YAML with nested configuration sections

**Usage:**
1. Edit `deployment.yaml` with your project-specific values
2. Commit and push changes
3. Pipeline automatically loads and applies the configuration

**Key Sections:**
- `project`: Project identity and naming
- `docker`: ACR configuration and repository names
- `kubernetes`: AKS cluster, namespace, deployment settings
- `service`: Service configuration and ports
- `ingress`: Domain, paths, TLS settings
- `build`: Dockerfile locations and contexts

---

### `k8s-env-config.txt`
**Environment variables configuration for Kubernetes deployments.**

This file defines which environment variables should be included in the Kubernetes deployment manifests generated by the Azure Pipeline.

**Format:**
```ini
[FRONTEND]
VARIABLE_NAME_1
VARIABLE_NAME_2

[BACKEND]
VARIABLE_NAME_3
VARIABLE_NAME_4
```

**Usage:**
- Only variable **names** are stored here, not values
- Actual values come from Azure Pipeline Variables or K8s Secrets
- The pipeline automatically reads this file during deployment

**Documentation:**
See [KUBERNETES-ENV-CONFIG.md](../docs/KUBERNETES-ENV-CONFIG.md) for complete documentation.

---

### `load-config.sh`
**Helper script that parses deployment.yaml and exports variables.**

This script is automatically executed by the Azure Pipeline at the beginning of each run. It:
- Parses `deployment.yaml`
- Extracts all configuration values
- Exports them as Azure Pipeline variables
- Validates that the configuration is properly formatted

You typically **don't need to run this manually**, but you can test it locally:
```bash
./config/load-config.sh config/deployment.yaml
```

---

## Quick Start

### To Change Your Project Configuration:

1. **Edit** `deployment.yaml`:
   ```yaml
   project:
     name: "my-awesome-project"
     short_name: "my-proj"
   
   docker:
     backend_repository: "my-backend-api"
     frontend_repository: "my-frontend-ui"
   
   kubernetes:
     namespace: "my-namespace"
   
   ingress:
     host: "my-domain.com"
   ```

2. **Commit and push** your changes

3. **Pipeline runs** and automatically uses your new configuration! üéâ

### To Add/Remove Environment Variables:

Edit `k8s-env-config.txt`:
```ini
[FRONTEND]
NEXT_PUBLIC_API_URL
MY_NEW_FRONTEND_VAR   # ‚Üê Add this

[BACKEND]
DATABASE_URL
MY_NEW_BACKEND_VAR    # ‚Üê Add this
```

---

## Benefits

‚úÖ **No Pipeline Editing**: Change configs without touching azure-pipeline.yml  
‚úÖ **Single Source of Truth**: All settings in one place  
‚úÖ **Version Controlled**: All changes tracked in git  
‚úÖ **Easy to Understand**: YAML format is human-readable  
‚úÖ **Reusable**: Fork this template and just edit config files  
‚úÖ **Type Safe**: Script validates configuration on load  

---

## Configuration Files Guide

### What Goes in `deployment.yaml`?
- Infrastructure settings (cluster names, namespaces)
- Service connection names
- Repository names
- Port numbers
- Domain names
- Deployment strategies
- Resource limits

### What Goes in `k8s-env-config.txt`?
- Environment variable **names** only
- Separate lists for frontend and backend
- No values, no secrets

### What DOESN'T Go Here?
‚ùå Secret values (passwords, API keys, tokens)  
‚ùå Environment-specific data (use Azure Pipeline Variables)  
‚ùå User credentials  
‚ùå Connection strings with passwords  

---

## Advanced Usage

### Testing Configuration Locally

```bash
# Test the config loader
cd /path/to/project
./config/load-config.sh config/deployment.yaml

# Check for YAML syntax errors
python3 -c "import yaml; yaml.safe_load(open('config/deployment.yaml'))"
```

### Multiple Environments

You can create environment-specific configs:
- `deployment.yaml` - Default/production
- `deployment-dev.yaml` - Development
- `deployment-staging.yaml` - Staging

Then modify the pipeline to load the appropriate config based on branch or parameter.

---

## Troubleshooting

**Pipeline fails at "Step 0 - Load Deployment Configuration"**
- Check YAML syntax in `deployment.yaml`
- Ensure all required fields are present
- Check for typos in field names

**Variables not being used in deployment**
- Verify the variable name in `deployment.yaml` matches the usage in pipeline
- Check that `load-config.sh` exports the variable
- Look for Azure Pipeline variable name conflicts

**Need help?**
See the main project README or check the pipeline logs for detailed error messages.

